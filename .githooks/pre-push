#!/bin/bash
# Block direct pushes to main branch
# All changes to main must go through PRs

protected_branch="main"

while read local_ref local_sha remote_ref remote_sha; do
    if [[ "$remote_ref" == "refs/heads/$protected_branch" ]]; then
        echo ""
        echo "ðŸš« Direct push to '$protected_branch' is blocked!"
        echo ""
        echo "   Per CLAUDE.md: 'Nothing merges without a PR and human approval'"
        echo ""
        echo "   Instead:"
        echo "   1. Create a feature branch: git checkout -b fix/my-change"
        echo "   2. Push the branch: git push -u origin fix/my-change"
        echo "   3. Create a PR: gh pr create"
        echo ""
        echo "   To bypass (emergencies only): git push --no-verify"
        echo ""
        exit 1
    fi
done

exit 0
