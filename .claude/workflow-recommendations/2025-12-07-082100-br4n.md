# Workflow Recommendation: Branch Hygiene

**Date:** 2025-12-07
**Session:** Branch cleanup and analysis

## Observations

1. **11 stale branches accumulated** - Several branches were 150-300+ commits behind dev, making them effectively dead. Branches included abandoned copilot experiments, old feature attempts, and forgotten release branches.

2. **main vs dev divergence** - main is 159 commits behind dev but has 161 unique commits. They diverged significantly and need reconciliation.

3. **No branch age visibility** - Without periodic review, stale branches accumulate silently.

## Recommendations

### Add to CLAUDE.md - Branch Maintenance Section

```markdown
### Branch Hygiene (Monthly)

Run branch audit monthly to prevent stale branch accumulation:

```bash
# List branches by last commit date with behind/ahead counts
for branch in $(git branch -r | grep -v HEAD); do
  behind=$(git rev-list --count origin/dev ^$branch 2>/dev/null || echo "?")
  ahead=$(git rev-list --count $branch ^origin/dev 2>/dev/null || echo "?")
  date=$(git log -1 --format='%ci' $branch 2>/dev/null | cut -d' ' -f1)
  echo "$date | $branch | +$ahead -$behind"
done | sort -r | head -20
```

**Delete criteria:**
- Branches 100+ commits behind with 0 unique commits (already merged)
- Branches 200+ commits behind (too stale to salvage)
- Copilot/exploration branches older than 2 weeks

**Keep criteria:**
- Active agent branches (agent/swing-N)
- Branches with open PRs
- main, dev, beads-metadata
```

### Consider: Periodic main-dev Sync

The main branch should periodically receive dev changes via PRs. Currently 159 commits behind suggests PRs aren't being created regularly enough.

## Action Items

- [ ] Add branch hygiene section to CLAUDE.md
- [ ] Create beads task for main-dev reconciliation
- [ ] Consider GitHub branch protection rules to auto-delete merged branches
